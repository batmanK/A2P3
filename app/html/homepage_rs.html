<!DOCTYPE html>
<html>
<head>
<style type="text/css">
  .loginStatus {text-align:right;}
  .loginItem {padding-left: 5px;}
  #qrcodeForm{border:1px solid #999; -webkit-box-shadow: 0px 0px 6px #CCC; background-color:#FFF; width:500px; height:520px; position: absolute; top:75px; left:10%; margin-left:-50px; padding:10px; border-radius:4px;}
</style>

</head>
<body>
  <script type="text/javascript"    src="/js/jquery-1.8.3.js"></script>
  <script type="text/javascript"    src="/js/purl.js"></script>
  <script type="text/javascript"    src="/js/jquery.qrcode.min.js"></script>
  <script type="text/javascript"    src="/js/config.js"></script>

<div class="loginStatus">
  <span id="loginEmail"></span>
  <a href="" id="loginBackdoor" class="loginItem"> backdoor login </a>
  <a href="/login" id="login" class="loginItem"> mobile agent login </a>
  <a href="" id="loginQR" class="loginItem"> QR login </a>
  <a href="/logout" id="logout" class="loginItem">logout </a>
</div>

<div id="qrcodeForm">
    <span class="form_title">Scan QR Code to login</span>
    <div id="qrcode"></div>
</div>


<H1 id='title'>XX Resource Server</H1>

<a href="/documentation">Documentation</a>

<script type="text/javascript">

  $('#qrcodeForm').hide()

  $('#loginQR').click( function () {
    $.get( '/login?json=true', function ( data, status ) {
      if (status == "success" && !data.error && data.result && data.result.request) {   // TBD, deal with error
        console.log('login for qr',data)
        $('#qrcodeForm').fadeIn('fast')
        $('#qrcode').qrcode( {width: 500, height: 500, text: data.result.request } )
      }
    })
    return false
  })


function onReady() {

  var setupURL = config.protocol + '://setup.' + config.baseDomain + ':' + config.port + '/backdoor'
  $('#loginBackdoor').attr('href', setupURL )

  // Write title and pull in image based on host we are at
  // URL is parsed in config.js and made available
  var title = config.subhost.charAt(0).toUpperCase() + config.subhost.substr( 1 )
  if (title === 'Si') title = 'Social Insurance'
  if ( config.province ) title += ' '+ config.provinceNames[config.province]
  title += ' Resource Server'
  $('#title').text( title )
  var flag = config.province || 'ca'
  $('#title').before('<img src="/images/flags/' + flag + '.png">')

  // check if we are logged in, if so, then show email and enable logout
  $.get('/login/check', function ( data, status ) {
    if (data && data.result && data.result.user) {
      $('#loginEmail').text(data.result.user)
      $('#logout').show()
      $('#login').hide()
      $('#loginBackdoor').hide()
    } else {
      $('#logout').hide()
      $('#login').show()
      $('#loginBackdoor').show()
    }
  })


} // onReady

$(document).ready(onReady)

</script>

</body>
</html>