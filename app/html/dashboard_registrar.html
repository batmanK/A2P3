<!DOCTYPE html>
<html>
<head>
<style type="text/css">
  .loginStatus {text-align:right;}
  .registerAppForm{border:1px solid #999; -webkit-box-shadow: 0px 0px 6px #CCC; background-color:#FFF; width:250px; height:140px; position: absolute; top:75px; left:50%; margin-left:-125px; padding:10px; border-radius:4px;}
</style>

</head>
<body>
  <script type="text/javascript"    src="/js/jquery-1.8.3.js"></script>
  <script type="text/javascript"    src="/js/purl.js"></script>
  <script type="text/javascript"    src="/js/config.js"></script>

  <div class="loginStatus">
    <span id="loginEmail"></span>
    <a href="" id="login"> login </a>
    <a href="/dashboard/logout" id="logout">logout </a>
  </div>

  <H1 id='title'>XX Dashboard</H1>

  <a href="" id="registerApp">Register Application</a>

<div id="registerApp_form" class="registerAppForm">
  <span class="form_title">Register an existing App</span>
    <form id="registerAppForm_input">
      <dl>
        <dt></dt><dd>
          <label for="AppName">Name</label>
          <input type="text" name="AppName" value="" id="registerApp_name_input">
        </dd>
        <dt></dt><dd>
          <label for="ApID">ID</label>
          <input type="text" name="AppID" value="" id="registerApp_id_input">
        </dd>
        <dt></dt><dd>
        <label id="registerApp_status"><i>ID is hostname</i></label>
      </dd>
      </dl>
        <p><input id="registerAppFormCancel" type="button" value="Cancel">
            <input id="registerAppFormSubmit" type="button" value="Register">
          </p>
    </form>
</div>


  <script type="text/javascript">
    (function() { // wrapper

    function updateDashboardTable () {

    }

    $('#showKey').click( function () {

    })

    $('#refreshKey').click( function () {

    })

    $('#deleteApp').click( function () {

    })

    $('#deleteAppConfirm').click( function () {

    })


    $('#registerApp_form').hide()

    $('#registerApp').click( function () {
      $('#registerApp_form').fadeIn('fast')
      $('#registerApp_id_input').val("")
      $('#registerApp_name_input').focus()
      $('#registerAppFormSubmit').attr("disabled", "disabled")
      return false
    })

    $('#registerApp_id_input').bind('input', function () {
      var host = $('#registerApp_id_input').val()
      if (!host) {
        $('#registerApp_status').text('Enter a valid hostname').css('color','black')
        $('#registerAppFormSubmit').attr("disabled", "disabled")

      } else if // valid hostname
          ( host.match( /^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$/ ) ) {
        $('#registerApp_status').text('Hostname is valid').css('color','black')
        $('#registerAppFormSubmit').removeAttr("disabled")

      } else {
        $('#registerApp_status').text('Hostname is invalid').css('color','red')
        $('#registerAppFormSubmit').attr("disabled", "disabled")
      }

    })

    $('#registerAppFormSubmit').click( function () {
      var host = $('#registerApp_id_input').val()
      var name = $()
      $('#registerApp_status').text('Registering App "'+host+'"" ... ').css('color','black')
      $('#registerAppFormSubmit').hide()
      $('#registerAppFormCancel').hide()

  console.log('Trying to register:"'+host+'"')
      $.post()

    })

    $('#registerAppFormCancel').click( function () {
          $('#registerApp_form').fadeOut('fast')
    })



    function onReady() {

      // Write title and pull in image based on host we are at
      // URL is parsed in config.js and made available
      var title = config.subhost.charAt(0).toUpperCase() + config.subhost.substr( 1 )
      if (title === 'Si') title = 'Social Insurance'
      if ( config.province ) title += ' '+ config.provinceNames[config.province]
      title += ' Resource Server Dashboard'
      $('#title').text( title )
      var flag = config.province || 'ca'
      $('#title').before('<img src="/images/flags/' + flag + '.png">')

      // check if we are logged in, if so, then show email and enable logout
      $.get('/dashboard/login/check', function ( data, status ) {
        if (data && data.result && data.result.user) {
          $('#loginEmail').text(data.result.user)
          $('#logout').show()
          $('#login').hide()
        } else {
          $('#logout').hide()
          $('#login').show()
        }
      })

      // get registered apps and insert into Dashboard table
    } // onReady

    $(document).ready(onReady)

    })(); // end wrapper
  </script>

</body>
</html>